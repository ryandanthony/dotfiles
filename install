#!/usr/bin/env bash
set -e

profile_flag=0
apps_flag=0
print_help=0
while [[ $# -gt 0 ]]; do
  case $1 in
      -p|--profile) profile_flag=1;;
      -a|--apps) apps_flag=1;;
      -h|--help) print_help=1;;
       *) echo "Unknown parameter passed: $1"; exit 1;;
  esac
  shift
done

if [[ $print_help -eq 1 ]]
then
  echo "Setup profile and install applications"
  echo "Designed for Ubuntu based images such as Kubuntu"
  echo "install-base.conf.yaml will always be run"
  echo "  --profile (-p) will run install-profile.conf.yaml "
  echo "  --apps (-a) will run install-apps.conf.yaml "
  echo "  --help (-a) for this help menu "
  exit 0
fi

git submodule sync --quiet --recursive
git submodule update --init --recursive

echo "############################# Running install-base.conf.yaml #############################"
sudo ./dotbot/bin/dotbot  -c install-base.conf.yaml -p dotbot_plugin_aptget/aptget.py --plugin-dir dotbot-vscode -p my-plugins/snap.py -p dotbot-golang/go.py -d "${BASEDIR}"

if [[ $apps_flag -eq 1 ]]
then
    echo "############################# Running install-apps.conf.yaml #############################"
    sudo ./dotbot/bin/dotbot  -c install-apps.conf.yaml -p dotbot_plugin_aptget/aptget.py --plugin-dir dotbot-vscode -p my-plugins/snap.py -p dotbot-golang/go.py -d "${BASEDIR}"
fi

if [[ $profile_flag -eq 1 ]]
then
  echo "############################# Running install-profile.conf.yaml #############################"
  ./dotbot/bin/dotbot  -c install-profile.conf.yaml -p dotbot_plugin_aptget/aptget.py --plugin-dir dotbot-vscode -p my-plugins/snap.py -p dotbot-golang/go.py -d "${BASEDIR}"
fi

